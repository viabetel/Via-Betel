generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Lead do aluno solicitando orçamento (sem contato direto com instrutor)
model Lead {
  id               String           @id @default(cuid())
  city             String
  neighborhood     String?
  category         String          // CNH desejada
  availability1    String          // opção 1
  availability2    String?         // opção 2
  availability3    String?         // opção 3
  objective        String?         // baliza, medo, prova, etc
  notes            String?
  studentName      String?         // opcional
  studentWhatsApp  String?         // opcional (nunca exposto ao instrutor)
  status           LeadStatus      @default(PENDING)
  createdAt        DateTime        @default(now())
  
  proposals        LeadProposal[]
  
  @@map("leads")
}

// Proposta do instrutor para um lead
model LeadProposal {
  id              String   @id @default(cuid())
  leadId          String
  lead            Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  instructorId    String
  instructor      Instructor @relation(fields: [instructorId], references: [id], onDelete: Cascade)
  message         String
  suggestedPrice  Int      // em centavos
  availability    String   // ex: "Segunda 08:00-12:00"
  createdAt       DateTime @default(now())
  
  @@map("lead_proposals")
}

// Instrutor (paga assinatura para aparecer no catálogo)
model Instructor {
  id               String          @id @default(cuid())
  slug             String          @unique
  name             String
  email            String          @unique
  city             String
  state            String
  categories       String          // "A,B,C"
  rating           Float           @default(4.5)
  price            Int             // em centavos
  specialties      String          // JSON array
  status           InstructorStatus @default(PENDING)
  createdAt        DateTime        @default(now())
  
  subscription     Subscription?
  boosts           Boost[]
  proposals        LeadProposal[]
  
  @@map("instructors")
}

// Assinatura do instrutor (Stripe Subscription)
model Subscription {
  id                      String   @id @default(cuid())
  instructorId            String   @unique
  instructor              Instructor @relation(fields: [instructorId], references: [id], onDelete: Cascade)
  stripeCustomerId        String   @unique
  stripeSubscriptionId    String   @unique
  status                  SubscriptionStatus @default(ACTIVE)
  currentPeriodEnd        DateTime
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
  
  @@map("subscriptions")
}

// Impulsionamento/Anúncios (add-on pago)
model Boost {
  id                String   @id @default(cuid())
  instructorId      String
  instructor        Instructor @relation(fields: [instructorId], references: [id], onDelete: Cascade)
  type              BoostType
  city              String
  startsAt          DateTime
  endsAt            DateTime
  stripePaymentId   String?
  createdAt         DateTime @default(now())
  
  @@map("boosts")
}

enum LeadStatus {
  PENDING
  CONTACTED
  CLOSED
}

enum InstructorStatus {
  PENDING
  ACTIVE
  INACTIVE
}

enum SubscriptionStatus {
  ACTIVE
  PAST_DUE
  CANCELED
}

enum BoostType {
  IMPULSIONAR_7_DIAS
  VITRINE_30_DIAS
}
